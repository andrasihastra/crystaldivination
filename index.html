<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Crystal Divination — A & B Deck</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  :root{
    --gold:#D4AF37;
    --bg:#ffffff;
    --ink:#0f1720;
    --muted:#6b7280;
    --card-w:200px;
    --radius:18px;
    --shadow: 0 18px 46px -24px rgba(0,0,0,.28), 0 0 0 2px rgba(212,175,55,.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial}
  .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:32px 18px 48px}
  header{text-align:center; margin-bottom:14px}
  .title{font-family:'Cormorant Garamond',serif;font-size:36px;margin:0}
  .subtitle{color:var(--muted);margin-top:6px;font-size:14px}

  .controls{display:flex;gap:10px;align-items:center;justify-content:center;margin:20px 0;flex-wrap:wrap}
  button{cursor:pointer;padding:10px 14px;border-radius:999px;border:0;background:#fff;font-weight:600;box-shadow:0 8px 22px rgba(0,0,0,.08)}
  button.primary{border:2px solid var(--gold)}
  button:disabled{opacity:.45;cursor:not-allowed}
  .status{color:var(--muted);font-size:13px;margin-left:6px}

  .grid-wrap{width:100%;display:flex;justify-content:center}
  .grid{
    width:100%;
    max-width:1200px;
    display:grid;
    grid-template-columns: repeat(7, minmax(0,1fr));
    gap:18px;
    justify-items:center;
    align-items:start;
    padding:12px;
  }
  @media (max-width:1100px){ .grid{ grid-template-columns:repeat(5,1fr) } }
  @media (max-width:880px){ .grid{ grid-template-columns:repeat(4,1fr) } }
  @media (max-width:680px){ .grid{ grid-template-columns:repeat(3,1fr); gap:14px } }
  @media (max-width:480px){ .grid{ grid-template-columns:repeat(2,1fr); gap:12px } }

  .card{ width: min(var(--card-w), 40vw); height: calc(min(var(--card-w), 40vw) * 1.45); perspective:1200px; position:relative }
  .card-inner{ position:relative;width:100%;height:100%;transform-style:preserve-3d;transition: transform 700ms cubic-bezier(.2,.8,.12,1); border-radius:var(--radius) }
  .card.flipped .card-inner{ transform: rotateY(180deg) }
  .face{ position:absolute; inset:0; border-radius:var(--radius); backface-visibility:hidden; overflow:hidden; background:#fff; border:1px solid rgba(0,0,0,.04) }
  .face.back{ display:grid; place-items:center; box-shadow: var(--shadow); background: linear-gradient(180deg,#fff,#fff) }
  .wing{ width:70%; height:70%; filter: drop-shadow(0 10px 30px rgba(212,175,55,.08)); opacity:.98 }
  .face.front{ transform: rotateY(180deg); padding:16px; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; text-align:center; position:relative }
  .badge{ color:var(--muted); font-size:11px; letter-spacing:.12em; text-transform:uppercase; font-family:'Cormorant Garamond',serif; margin-top:6px }
  .name{ font-family:'Cormorant Garamond',serif; font-weight:600; font-size:18px; margin-top:6px; line-height:1.05 }
  .rule{ width:72%; height:1px; margin:12px 0; background:linear-gradient(90deg, transparent, var(--gold), transparent) }
  .meaning{ font-family:'Cormorant Garamond',serif; color:#222; padding:0 6px; font-size:14px; line-height:1.35; min-height:52px }
  .hint{ margin-top:auto; font-size:12px; color:var(--muted); padding-top:10px }
  .lux{ position:absolute; inset:-8px; pointer-events:none; border-radius:calc(var(--radius)+8px); box-shadow: 0 0 60px rgba(212,175,55,.06) }

  .footer{ margin-top:18px; text-align:center; color:var(--muted); font-size:13px; max-width:820px }
  .small{ font-size:12px;color:var(--muted) }

  button:focus{ outline:3px solid rgba(212,175,55,.16); outline-offset:3px; border-radius:14px }
  .card:focus{ outline: none }
</style>
</head>
<body>
  <div class="wrap" role="application" aria-labelledby="title">
    <header>
      <h1 id="title" class="title">Crystal Divination</h1>
      <div class="subtitle">Draw 7 cards — click any card (or press Enter) to flip and reveal a short spiritual message.</div>
    </header>

    <div class="controls" role="region" aria-label="controls">
      <button id="drawBtn" class="primary">Shuffle &amp; Draw 7</button>
      <button id="flipUp" disabled>Flip All Up</button>
      <button id="flipDown" disabled>Flip All Down</button>
      <div class="status" id="status">Loading deck...</div>
    </div>

    <div class="grid-wrap">
      <section id="grid" class="grid" aria-live="polite" aria-busy="true"></section>
    </div>

    <div class="footer">Angel wings card back • White &amp; gold luxury feel • Responsive for desktop, tablet and mobile.</div>
  </div>

<script>
const ANGEL_SVG = "https://raw.githubusercontent.com/andrasihastra/angelsanctuary/refs/heads/main/angelwings.svg";
const DECK_URL = "deck.json"; // fetch locally (works on GitHub Pages)

let DECK = [];
const grid = document.getElementById('grid');
const drawBtn = document.getElementById('drawBtn');
const flipUp = document.getElementById('flipUp');
const flipDown = document.getElementById('flipDown');
const status = document.getElementById('status');

function shuffle(arr){
  for (let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

function renderCards(list, faceDown = true){
  grid.innerHTML = '';
  for (const item of list){
    const card = document.createElement('div');
    card.className = 'card' + (faceDown ? '' : ' flipped');
    card.tabIndex = 0;

    const inner = document.createElement('div'); inner.className = 'card-inner';

    // back
    const back = document.createElement('div'); back.className = 'face back';
    const img = document.createElement('img'); img.className = 'wing'; img.src = ANGEL_SVG; img.alt = 'Angel wings';
    back.appendChild(img);

    // front
    const front = document.createElement('div'); front.className = 'face front';
    front.innerHTML = `
      <div class="badge">REVEALED</div>
      <div class="name">${escapeHtml(item.name)}</div>
      <div class="rule"></div>
      <div class="meaning">${escapeHtml(item.meaning)}</div>
      <div class="hint">Click to Flip</div>
      <div class="lux" aria-hidden="true"></div>
    `;

    inner.appendChild(back);
    inner.appendChild(front);
    card.appendChild(inner);

    card.addEventListener('click', ()=> card.classList.toggle('flipped'));
    card.addEventListener('keydown', (e)=> { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); card.classList.toggle('flipped'); }} );

    grid.appendChild(card);
  }
  window.scrollTo({top:0, behavior:'smooth'});
}

let currentDraw = [];
drawBtn.addEventListener('click', ()=>{
  if (DECK.length < 7) return;
  const copy = shuffle([...DECK]);
  currentDraw = copy.slice(0,7);
  renderCards(currentDraw, true);
  flipUp.disabled = false;
  flipDown.disabled = false;
  status.textContent = `7 cards drawn — click any to flip.`;
});
flipUp.addEventListener('click', ()=> document.querySelectorAll('.card').forEach(c=>c.classList.add('flipped')));
flipDown.addEventListener('click', ()=> document.querySelectorAll('.card').forEach(c=>c.classList.remove('flipped')));

// Load JSON deck
fetch(DECK_URL)
  .then(r => r.json())
  .then(data => {
    DECK = data;
    status.textContent = `Deck ready — ${DECK.length} cards.`;
    // show placeholders
    const placeholders = Array.from({length:7}).map(()=>({name:'—', meaning:'Shuffle & draw to reveal.'}));
    renderCards(placeholders, false);
  })
  .catch(err => {
    console.error("Error loading deck:", err);
    status.textContent = "❌ Failed to load deck.";
  });
</script>
</body>
</html>
